import java.io.*;
import java.util.ArrayList;
import java.util.Scanner;
class Librarian extends Library implements UserIU {
    Scanner myScan = new Scanner(System.in);
    String names = "C:\\Users\\Ghost\\IdeaProjects\\Library_Management_System\\librarians.txt";
    String passwords = "C:\\Users\\Ghost\\IdeaProjects\\Library_Management_System\\libKeys.txt";
    File librarians = new File(names);
    File libKeys = new File(passwords);

    public int option;
    public Librarian() {
        super();
    }

    Student stu = new Student();
    // Class methods
    @Override
    public void Operation() throws IOException {
        System.out.println("\n1.AddUser\n2.AddBook\n3.Issue returned books\n4.ViewUsers\n5.ViewBooks\n6.ViewBooksReturned\n7.Logout");
        System.out.print("Input: ");
        option = myScan.nextInt();
        switch (option) {
            case 1:
                addUser();
                break;
            case 2:
                addBook();
                break;
            case 3:
                try{
                    issue_returnedBooks();
                }
                catch (Exception e){
                    System.out.println(e.getMessage());
                }
                finally {
                    Operation();
                }
                break;
            case 4:
                viewUsers();
                break;
            case 5:
                viewBooks();
                break;
            case 6:
                viewBooksReturned();
                break;
            case 7:
                loggedIn = false;
                System.out.println("Have an amazing day");
                Login();
                break;
        }
    }

    public void addUser() throws IOException {

        Scanner libReader = new Scanner(librarians);
        Scanner stuReader = new Scanner(stu.studentNames);
        System.out.print("Username: ");
        String username = myScan.next();
        System.out.print("Password: ");
        String password = myScan.next();
        System.out.print("Role: ");
        String role = myScan.next();
        ArrayList<String> libData = new ArrayList<>();
        ArrayList<String> stuData = new ArrayList<>();
        while (libReader.hasNextLine() && stuReader.hasNextLine()) {
            libData.add(libReader.nextLine());
            stuData.add(stuReader.nextLine());
        }
        if (role.equals("Librarian") && !libData.contains(username)){
            FileWriter libWriter = new FileWriter(names, true);
            PrintWriter pw = new PrintWriter(libWriter);
            pw.append("\n").append(username);
            pw.close();
            libWriter.close();
            FileWriter libkeyWriter = new FileWriter(passwords, true);
            PrintWriter pw2 = new PrintWriter(libkeyWriter);
            pw2.append("\n").append(password);
            pw2.close();
            libkeyWriter.close();
            System.out.println("Librarian added successfully");
        }
        else if (role.equals("Student") && !stuData.contains(username)){
            FileWriter stuWriter = new FileWriter(stu.names, true);
            PrintWriter pw3 = new PrintWriter(stuWriter);
            pw3.append("\n").append(username);
            pw3.close();
            stuWriter.close();
            FileWriter stukeyWriter = new FileWriter(stu.numbers, true);
            PrintWriter pw4 = new PrintWriter(stukeyWriter);
            pw4.append("\n").append(password);

            pw4.close();
            stukeyWriter.close();
            System.out.println("Student added successfully");
        }
        else{
            System.out.println("The role entered is invalid");
        }
        Operation();
    }
    public void addBook() throws IOException {
        System.out.print("Book Title: ");
        bookTitle = myScan.next();
        System.out.print("Author: ");
        author = myScan.next();
        System.out.print("Category: ");
        subjectCat = myScan.next();
        if (!books.contains(bookTitle) && !borrowedBooks.contains(bookTitle)){

        }
        else{
            System.out.println("That book already belongs to the library!");
        }
        Operation();
    }
    @Override
    public void issueBooks() {
        System.out.print("Book title: ");
        String bookName = myScan.next();
        if (books.contains(bookName)){
            myBooks.add(bookName);
            books.remove(bookName);
            borrowedBooks.add(bookName);
            System.out.print("Book successfully issued.");
        }
        else {
            System.out.println("Book entered does not exist");
        }
    }
    @Override
    public void issue_returnedBooks() throws Exception{
        System.out.print("Book title: ");
        String title = myScan.next();
        if (myBooks.contains(title)){
            books.add(title);
            myBooks.remove(title);
            returnedBooks.add(title);
            System.out.println("Book successfully returned");
        }
        else{
            throw new Exception("Book entered does not exist!");
        }
    }
    public void viewUsers() throws IOException {
        System.out.println("Librarians");
        Scanner libReader = new Scanner(librarians);
        while (libReader.hasNextLine()) {
            String libData = libReader.nextLine();
            System.out.println(libData);

        }

        System.out.print("Students: ");
        Scanner stuReader = new Scanner(stu.studentNames);
        while (stuReader.hasNextLine()) {
            String stuData = stuReader.nextLine();
            System.out.println(stuData);
        }
        libReader.close();
        stuReader.close();
        System.out.println("\n1.Add user\n2.Back to menu");
        System.out.print("Input: ");
        int choice = myScan.nextInt();
        switch (choice){
            case 1:
                addUser();
                break;
            case 2:
                Operation();
                break;
        }
        Operation();
    }
    public void viewBooks() throws IOException {
        for(int x = 0; x < books.size(); x++){
            System.out.print(books.get(x) + ", ");
        }
        amountOfBooks = books.size();
        System.out.println("Available: "+ amountOfBooks);
        Operation();
    }
    public void viewBooksReturned(){}

}
